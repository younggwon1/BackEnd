# Java 메모리 모델

JVM은 운영체제로부터 할당받은 메모리를 사용해 Java 프로그램을 실행한다.

JVM은 할당받은 메모리를 효율적으로 사용하기 위해 3개의 메모리 영역으로 나눠서 관리한다.

**Method 영역 , Stack 영역 , Heap 영역**

 <img width="333" alt="스크린샷 2022-03-18 오후 12 06 20" src="https://user-images.githubusercontent.com/73063032/158929976-6171d01a-6aab-4999-a0c4-f2b245879ea3.png" style="zoom:67%;" >



### Method 영역

**Method 영역은 Method의 바이트 코드, Class 정보, 전역변수 정보, Static 변수 정보가 저장되는 공간이다.**

- JVM은 자바 프로그램에서 특정 클래스가 사용되면 해당 클래스의 클래스 파일(*.class)를 읽어들여, 해당 클래스에 대한 정보를 Method 영역에 저장한다.
  - 클래스 별로 runtime constant pool(런타임 상수 풀), file data(필드 데이터), method data(메서드 데이터), constructor(생성자) 등을 저장

1. 필드 정보 : 멤버변수 이름, 데이터 타입, 접근 제어자 등의 정보

2. 메서드 정보 : 메서드 이름, 리턴 타입, 매개 변수, 접근 제어자 등의 정보

3. 상수 풀(String Constant Pool)

- Type에서 사용된 상수를 저장하는 곳(중복이 있을 시 기존의 상수 사용)

- 문자 상수, 타입, 필드, Method reference도 상수 풀에 저장

- final class 변수의 경우에도 상수 풀에 값 복사

4. Static 변수

- 모든 객체가 공유 할 수 있고, 객체 생성없이 접근 가능

5. 프로그램 종료까지 메모리에 상주

6. Static 영역 데이터는 프로그램 시작 ~ 종료 시까지 메모리에 남아있다.

- 장점 : 즉 프로그램이 종료될 까지 어디서든 사용 가능

- 단점 : 무분별하게 많이 사용하다 보면 메모리가 부족



### Stack 영역

**Stack 영역은 지역 변수와 매개 변수가 저장되는 공간이다.**

자바 프로그램에서 메소드가 호출될 때 메소드의 스택 프레임이 저장되는 영역이다.

JVM은 자바 프로그램에서 메소드가 호출되면, 메소드의 호출과 관계되는 지역 변수와 매개 변수를 스택 영역에 저장한다.

이렇게 스택 영역은 메소드의 호출과 함께 할당되며, 메소드의 호출이 완료되면 소멸한다.

이렇게 스택 영역에 저장되는 메소드의 호출 정보를 스택 프레임(stack frame)이라고 한다.



### Heap 영역

**Heap 영역은 인스턴스 변수가 저장되는 공간이다.** 

JVM은 자바 프로그램에서 new 키워드를 사용하여 인스턴스가 생성되면, 해당 인스턴스의 정보를 힙 영역에 저장한다.

즉, new 연산자로 생성된 객체, Array와 같은 동적으로 생성된 데이터가 저장되는 공간이다.

모든 Object 타입은 heap 영역에 생성된다.

1. 객체(인스턴스 - new 연산자로 생성된 객체)가 저장되는 영역

2. 프로그램 실행 중 생성되는 모든 객체는 Heap 영역에 동적으로 할당

- Garbage Collector 를 통해 메모리 반환

3. 참조형(Reference Type)의 데이터 타입을 갖는 객체(인스턴스), 배열 등은 Heap 영역에 데이터가 저장된다.

- 실제 데이터가 저장된 Heap 영역의 참조값(reference value, 해시코드/메모리에 저장된 주소를 연결해주는 값)을 저장





**참고**

[메모리 구조](http://www.tcpschool.com/java/java_array_memory)

[[JAVA] #22 자바 메모리 모델](https://travelbeeee.tistory.com/456?category=845655)

[[Java] 자바 메모리 구조](https://zoiworld.tistory.com/710)